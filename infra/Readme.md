# Overview
## ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Package ‡∏î‡πâ‡∏ß‡∏¢ Helm

**Helm** ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏™‡∏°‡∏∑‡∏≠‡∏ô "App Store" ‡∏´‡∏£‡∏∑‡∏≠ `apt-get` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Kubernetes ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤ **Charts**

### ‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ Helm ‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ?

‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‡πÄ‡∏£‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á **Spark Operator** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Kubernetes ‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô Spark ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ ‡∏ã‡∏∂‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ú‡πà‡∏≤‡∏ô Helm ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (RBAC) ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

### ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Helm

‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏° [Official Guide](https://helm.sh/docs/intro/install/) ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á:

```bash
helm version
```

---

## ‚ö°Ô∏è ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Spark Operator (‡∏ú‡πà‡∏≤‡∏ô Helm)

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏ü‡∏•‡πå YAML ‡∏ó‡∏µ‡πà‡∏°‡∏µ `kind: SparkApplication` ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏á Operator ‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö:

1. **‡πÄ‡∏û‡∏¥‡πà‡∏° Helm Repo:**

```bash
helm repo add spark-operator https://kubeflow.github.io/spark-operator
helm repo update
```

2. **‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Operator 
2.1 ‡∏•‡∏á‡πÉ‡∏ô namespace `argo`:**
```bash
helm install my-spark-operator spark-operator/spark-operator \
    --namespace argo \
    --set webhook.enable=true
```

(‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ `webhook.enable=true` ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ Kubernetes ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå YAML ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏±‡πà‡∏á‡∏£‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö)

2.2 ‡πÅ‡∏¢‡∏Å namespace

```bash
helm install <release_name> spark-operator/spark-operator \
  --namespace <namespace> \
  --create-namespace \
  --set webhook.enable=true

```
> ‡∏´‡∏≤‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏≥ namespace ‡πÅ‡∏¢‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡πá‡∏Ñ namespace ‡∏ï‡πà‡∏≠‡∏î‡πâ‡∏ß‡∏¢
```bash
kubectl get ns
```
‡∏Å‡∏£‡∏ì‡∏µ‡∏≠‡∏¢‡∏≤‡∏Å‡∏•‡∏ö 
- ‡∏•‡∏ö release 
```bash
helm uninstall <release_name> --namespace <namespace>
```
- ‡∏•‡∏ö namespace
```
kubectl delete namespace <namespace>
```
## üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö

‡∏ô‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ Pod ‡∏Ç‡∏≠‡∏á Argo ‡πÅ‡∏•‡πâ‡∏ß ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÄ‡∏ä‡πá‡∏Ñ Pod ‡∏Ç‡∏≠‡∏á Spark Operator ‡∏î‡πâ‡∏ß‡∏¢:

```bash
kubectl get pods -n argo -l app.kubernetes.io/name=spark-operator
```

## üîê ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (RBAC) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Spark Operator ‡πÅ‡∏•‡∏∞ Argo Workflow

‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á Kubernetes ‡∏Å‡∏≤‡∏£‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå YAML ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß **‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠**
‡πÄ‡∏û‡∏£‡∏≤‡∏∞ Kubernetes ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà **‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏à‡∏≠‡∏∞‡πÑ‡∏£‡πÇ‡∏î‡∏¢‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (Zero Trust)**

‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢ ‡πÜ:

> ‡πÄ‡∏£‡∏≤‡∏°‡∏µ ‚Äú‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‚Äù (YAML)
> ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤ ‚Äú‡∏Ñ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‚Äù ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ï‡∏£‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (ServiceAccount)
> ‡∏Å‡πá‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏±‡πà‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ

‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡∏ö‡∏±‡∏ï‡∏£ + ‡∏Å‡∏é‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‚Äù ‡∏Å‡πá‡∏Ñ‡∏∑‡∏≠ **RBAC (Role-Based Access Control)**


## ü§î ‡∏ó‡∏≥‡πÑ‡∏°‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ RBAC?

‡πÉ‡∏ô Pipeline ‡∏ô‡∏µ‡πâ ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏´‡∏•‡∏±‡∏Å 2 ‡∏ï‡∏±‡∏ß:

### Argo Workflow

* ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà orchestration
* ‡∏ï‡πâ‡∏≠‡∏á **‡∏™‡∏£‡πâ‡∏≤‡∏á resource ‡∏ä‡∏∑‡πà‡∏≠ `SparkApplication`**
* ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‚Üí Workflow ‡∏à‡∏∞ fail ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ

### Spark Driver (‡∏£‡∏±‡∏ô‡πÉ‡∏ô Pod)

* ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢ Spark Operator
* ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå:

  * ‡∏™‡∏£‡πâ‡∏≤‡∏á Pod ‡πÉ‡∏´‡∏°‡πà (Executor)
  * ‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Pod ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á
* ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‚Üí Spark job ‡∏à‡∏∞‡∏Ñ‡πâ‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠ fail ‡πÅ‡∏ö‡∏ö‡∏á‡∏á ‡πÜ

---

## ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ

| ‡∏ï‡∏±‡∏ß‡πÑ‡∏´‡∏ô         | ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£                              |
| -------------- | --------------------------------------- |
| Argo Workflow  | create / get / watch `SparkApplication` |
| Spark Driver   | create / get / delete `Pod`             |
| Spark Operator | watch / manage `SparkApplication`       |

---

## ServiceAccount ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ

‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ô‡∏µ‡πâ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÅ‡∏¢‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô:

| ServiceAccount      | ‡πÉ‡∏ä‡πâ‡πÇ‡∏î‡∏¢                  |
| ------------------- | ----------------------- |
| `argo`              | Argo Workflow           |
| `spark-operator-sa` | Spark Driver / Executor |

---

## ‡∏™‡∏£‡πâ‡∏≤‡∏á ServiceAccount ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Spark

> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ô namespace ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö SparkApplication (‡πÄ‡∏ä‡πà‡∏ô `argo`)

```yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: spark-operator-sa
  namespace: argo
```

Apply:

```bash
kubectl apply -f spark-sa.yaml
```

---

## ‡∏™‡∏£‡πâ‡∏≤‡∏á Role ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Spark Driver

Role ‡∏ô‡∏µ‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡πà‡∏≤ Spark Driver **‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÑ‡∏î‡πâ‡∏ö‡πâ‡∏≤‡∏á‡πÉ‡∏ô namespace**

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: spark-driver-role
  namespace: argo
rules:
  - apiGroups: [""]
    resources: ["pods", "services", "configmaps"]
    verbs: ["create", "get", "list", "watch", "delete"]
```

---

## ‡∏ú‡∏π‡∏Å Role ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö ServiceAccount (RoleBinding)

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: spark-driver-binding
  namespace: argo
subjects:
  - kind: ServiceAccount
    name: spark-operator-sa
    namespace: argo
roleRef:
  kind: Role
  name: spark-driver-role
  apiGroup: rbac.authorization.k8s.io
```

Apply:

```bash
kubectl apply -f spark-rbac.yaml
```

---

## ‡∏ú‡∏π‡∏Å SparkApplication ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ ServiceAccount ‡∏ô‡∏µ‡πâ

‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå `SparkApplication`:

```yaml
spec:
  driver:
    serviceAccount: spark-operator-sa
```

‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ ‚Üí ‡∏à‡∏∞‡πÉ‡∏ä‡πâ `default` service account ‡∏ã‡∏∂‡πà‡∏á **‡πÅ‡∏ó‡∏ö‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏•‡∏¢**

---

## üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ RBAC ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

### ‡πÄ‡∏ä‡πá‡∏Ñ ServiceAccount

```bash
kubectl get sa -n argo
```

### ‡πÄ‡∏ä‡πá‡∏Ñ Role / RoleBinding

```bash
kubectl get role,rolebinding -n argo
```

### ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å (simulate permission)

```bash
kubectl auth can-i create pods \
  --as=system:serviceaccount:argo:spark-operator-sa \
  -n argo
```
‡∏•‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏û‡∏¥‡πà‡∏°:
```bash
kubectl auth can-i create services \
  --as=system:serviceaccount:argo:spark-operator-sa \
  -n argo
```
